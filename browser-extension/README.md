# AI笔记收藏助手 - 浏览器插件

一键收藏网页到AI笔记系统的浏览器扩展插件。

## 功能特性

- ✅ 一键收藏当前网页
- ✅ 自动提取网页标题和链接
- ✅ **智能解析网页内容，提取纯净文章**
- ✅ **自动获取文章元数据（标题、摘要、关键词）**
- ✅ 支持选择目标文件夹
- ✅ 自动创建笔记文档
- ✅ 容错处理，解析失败时仅保存链接

## 目录结构

```
browser-extension/
├── manifest.json              # 插件配置文件
├── popup/
│   ├── popup.html            # 弹窗界面
│   ├── popup.js              # 弹窗逻辑
│   └── popup.css             # 弹窗样式
├── background/
│   └── service-worker.js     # 后台服务
├── utils/
│   └── api-client.js         # API客户端
└── icons/                    # 插件图标
    └── README.txt
```

## 安装方法

### 准备工作

**重要！**在安装插件之前，需要准备微信公众号二维码图片：

1. 从主项目复制 `/public/wechat_login.jpg` 到 `/browser-extension/wechat_login.jpg`
2. 或者使用相同的公众号二维码图片，文件名必须为 `wechat_login.jpg`

如果没有这个文件，登录界面将无法显示二维码。

### Chrome/Edge 浏览器

1. 打开浏览器，进入扩展程序管理页面
   - Chrome: `chrome://extensions/`
   - Edge: `edge://extensions/`

2. 开启右上角的"开发者模式"

3. 点击"加载已解压的扩展程序"

4. 选择 `browser-extension` 文件夹

5. 安装完成！插件图标会出现在浏览器工具栏

## 使用方法

### 首次使用 - 登录

1. 点击浏览器工具栏的插件图标
2. 弹出登录界面，显示微信公众号二维码
3. 使用微信扫码关注公众号【白小年1999】
4. 在公众号内发送 `666` 获取登录验证码
5. 将收到的6位验证码输入到插件的输入框中
6. 点击“登录”按钮
7. 验证成功后即可使用

**注意：**
- 验证码有效期为1分钟，请尽快输入
- 未注册用户将自动创建账号
- 登录后会保存登录状态，无需每次输入

### 收藏网页

1. 在任意网页上点击插件图标
2. 插件会自动显示当前页面的标题和来源
3. 在文件夹列表中选择目标文件夹（点击即可选中，背景会变为蓝色）
4. 点击"收藏"按钮
5. 等待2-3秒，显示"收藏成功"后自动关闭
6. 打开AI笔记网站，在对应文件夹中即可看到新创建的文档

### 文档格式

收藏后创建的文档格式如下：

**成功解析网页时：**

```html
<h1>[文章标题]</h1>

<p><strong>原文链接</strong>: <a href="URL" target="_blank">URL</a></p>

<p><strong>摘要</strong>: 文章摘要内容</p>

<p><strong>关键词</strong>: 关键词1,关键词2,关键词3</p>

<p><strong>收藏时间</strong>: 2026-01-03 13:55:15</p>

<hr>

[纯净的文章内容，HTML格式，直接适配tiptap编辑器]
```

**解析失败时的退化方案：**

```html
<h1>[网页标题]</h1>

<p><strong>原文链接</strong>: <a href="URL" target="_blank">URL</a></p>

<p><strong>收藏时间</strong>: 2026-01-03 13:55:15</p>

<hr>
```

## API接口

插件使用以下API接口：

- `POST /auth/wechat/verify` - 微信登录验证
- `GET /api/knowledge-base` - 获取知识库结构
- `POST /api/documents` - 创建文档
- **`POST /api/scraper/scrape` - 抓取网页内容（新增）**

## 权限说明

插件需要以下权限：

- `activeTab` - 访问当前标签页信息（获取标题和URL）
- `storage` - 本地存储（保存Token）
- `scripting` - 注入脚本
- `https://api.knowbit.cn/*` - 访问API接口

## 常见问题

### 1. 登录失败

- 确认验证码是否正确（6位数字）
- 确认验证码是否已过期（有效期1分钟）
- 检查网络连接
- 尝试重新在公众号获取验证码

### 2. 文件夹列表加载失败

- 检查是否已登录
- 确认API服务是否正常
- 查看浏览器控制台错误信息

### 3. 收藏失败

- 确认是否选择了文件夹
- 检查网络连接
- 查看错误提示信息

### 4. 找不到收藏的文档

- 刷新AI笔记网站页面
- 检查是否在正确的文件夹中
- 确认收藏操作是否显示成功

## 开发计划

- [x] 支持网页内容自动解析
- [x] 支持HTML格式转换（适配tiptap编辑器）
- [ ] 支持图片上传
- [ ] 支持快捷键操作
- [ ] 支持批量收藏
- [ ] 支持离线缓存
- [ ] 支持标签自动提取

## 技术栈

- Manifest V3
- Vanilla JavaScript
- Chrome Extension APIs

## 注意事项

1. 验证码有效期为1分钟，请及时输入
2. 插件会在本地浏览器保存登录信息
3. 建议定期登出并重新登录以保证安全
4. 需要先关注微信公众号【白小年1999】才能登录

## 联系方式

如有问题或建议，请联系开发团队。
